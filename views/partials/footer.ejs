</main>

<!-- Footer -->
<footer class="site-footer" role="contentinfo">
    <div class="footer-inner">
        <p class="footer-text">
            Â© 2030 <span class="gradient-text">CineVerse</span> â€” The Future of Cinema
        </p>
        <div class="footer-links">
            <a href="/admin">Home</a>
            <a href="/movies/view-movies">Browse</a>
            <a href="/movies/add-movies">Add Movie</a>
        </div>
    </div>
</footer>
</div>

<script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Global Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    // Mobile nav toggle
    document.getElementById('nav-hamburger')?.addEventListener('click', function () {
        const links = document.getElementById('nav-links');
        const isOpen = links.classList.toggle('mobile-open');
        this.setAttribute('aria-expanded', isOpen);
    });

    // Highlight active nav link
    (function highlightNav() {
        const path = window.location.pathname;
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
            const href = link.getAttribute('href');
            if (path === href || (href !== '/admin' && path.startsWith(href))) {
                link.classList.add('active');
            }
        });
        // Home special case
        if (path === '/' || path === '/admin') {
            document.getElementById('nav-home')?.classList.add('active');
        }
    })();

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Toast System â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showToast(type, title, message) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
            <div class="toast-icon" aria-hidden="true">
                ${type === 'success' ? 'âœ“' : 'âœ•'}
            </div>
            <div class="toast-body">
                <div class="toast-title">${title}</div>
                <div class="toast-message">${message}</div>
            </div>
            <button class="toast-close" aria-label="Close notification">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        `;
        container.appendChild(toast);

        toast.querySelector('.toast-close').addEventListener('click', () => removeToast(toast));

        setTimeout(() => removeToast(toast), 4000);
    }

    function removeToast(toast) {
        if (!toast || toast.classList.contains('removing')) return;
        toast.classList.add('removing');
        setTimeout(() => toast.remove(), 300);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Delete Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let deleteTargetId = null;

    function openDeleteModal(movieId) {
        deleteTargetId = movieId;
        document.getElementById('delete-modal').classList.add('active');
        document.getElementById('modal-cancel-btn').focus();
    }

    function closeDeleteModal() {
        document.getElementById('delete-modal').classList.remove('active');
        deleteTargetId = null;
    }

    document.getElementById('modal-cancel-btn')?.addEventListener('click', closeDeleteModal);

    document.getElementById('delete-modal')?.addEventListener('click', function (e) {
        if (e.target === this) closeDeleteModal();
    });

    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') closeDeleteModal();
    });

    document.getElementById('modal-confirm-btn')?.addEventListener('click', async function () {
        if (!deleteTargetId) return;
        this.innerHTML = '<div class="spinner"></div> Deleting...';
        this.disabled = true;

        try {
            const res = await fetch(`/movies/delete-movie/${deleteTargetId}`, {
                method: 'DELETE',
                headers: { 'Accept': 'application/json' }
            });
            const data = await res.json();

            if (data.success) {
                const card = document.querySelector(`[data-movie-id="${deleteTargetId}"]`);
                if (card) {
                    card.style.transition = 'all 0.4s ease-out';
                    card.style.transform = 'scale(0.8) translateY(20px)';
                    card.style.opacity = '0';
                    setTimeout(() => card.remove(), 400);
                }
                showToast('success', 'Deleted!', 'Movie removed from your collection.');
                // Update stats if they exist
                updateMovieCount();
            } else {
                showToast('error', 'Error', data.message || 'Failed to delete movie.');
            }
        } catch (err) {
            showToast('error', 'Network Error', 'Could not connect to the server.');
        }

        closeDeleteModal();
        this.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg> Delete`;
        this.disabled = false;
    });

    // Update movie count in stats
    function updateMovieCount() {
        const countEl = document.getElementById('movie-count');
        if (countEl) {
            const current = parseInt(countEl.textContent) || 0;
            countEl.textContent = Math.max(0, current - 1);
        }
        // Check if grid is empty
        setTimeout(() => {
            const grid = document.getElementById('movies-grid');
            if (grid && grid.children.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">ðŸŽ¬</div>
                        <h3>No movies yet</h3>
                        <p>Your collection is empty. Start by adding your first movie to the vault.</p>
                        <a href="/movies/add-movies" class="btn btn-primary btn-lg">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
                            Add First Movie
                        </a>
                    </div>
                `;
            }
        }, 500);
    }
</script>
</body>

</html>